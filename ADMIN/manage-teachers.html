<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Teachers</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <link rel="stylesheet" href="/CSS/manage-teacher.css">
  <meta http-equiv="Expires" content="0" />

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
</head>

<body>

  <div class="sidebar">
    <h2>Admin Panel</h2>
    <ul>
      <li><a href="admin-home.html"><i class="fa fa-home"></i> Dashboard</a></li>
      <li><a href="manage-teachers.html"><i class="fa fa-users"></i> Manage Teachers</a></li>
      <li><a href="manage-notices.html"><i class="fa fa-bell"></i> Manage Notices</a></li>
      <li><a href="manage-gallery.html"><i class="fa fa-image"></i> Manage Gallery</a></li>
      <li><a href="manage-results.html"><i class="fa fa-graduation-cap"></i> Manage Results</a></li>
      <li><a href="settings.html"><i class="fa fa-cog"></i> Settings</a></li>
      <li><a href="login.html"><i class="fa fa-sign-out"></i> Logout</a></li>
    </ul>
  </div>

  

  <div class="form-box">
    <h3>Add Teacher</h3>
    <input type="text" id="name" placeholder="Name" required>
    <input type="email" id="email" placeholder="Email" required>
    <input type="text" id="phone" placeholder="Phone" required>
    <input type="text" id="subject" placeholder="Subject" required>
    <input type="file" id="photo" accept="image/*" required>
    <button id="addTeacherBtn">âž• Add Teacher</button>
  </div>

  <div class="table-container">
    <table id="teacherTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Photo</th>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Subject</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const fetchTeachers = () => {
      fetch('/admin/teachers')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#teacherTable tbody');
          tbody.innerHTML = '';
          data.forEach(teacher => {
            tbody.innerHTML += `
          <tr>
            <td>${teacher._id}</td>
            <td><img src="/uploads/${teacher.photo || 'default.png'}" alt="photo"></td>
            <td contenteditable="true" class="name">${teacher.name}</td>
            <td contenteditable="true" class="email">${teacher.email}</td>
            <td contenteditable="true" class="phone">${teacher.phone}</td>
            <td contenteditable="true" class="subject">${teacher.subject}</td>
            <td>
              <button onclick="updateTeacher('${teacher._id}', this)">Update</button>
              <button onclick="deleteTeacher('${teacher._id}')">Delete</button>
            </td>
          </tr>
        `;
          });
        });
    };

    document.getElementById('addTeacherBtn').addEventListener('click', () => {
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const phone = document.getElementById('phone').value;
      const subject = document.getElementById('subject').value;
      const photo = document.getElementById('photo').files[0];

      const formData = new FormData();
      formData.append("name", name);
      formData.append("email", email);
      formData.append("phone", phone);
      formData.append("subject", subject);
      formData.append("photo", photo);

      fetch('/admin/add-teacher', {
        method: 'POST',
        body: formData
      })
        .then(res => res.json())
        .then(data => {
          alert(data.message);
          fetchTeachers();
        });
    });

    function updateTeacher(id, btn) {
      const row = btn.parentElement.parentElement;
      const name = row.querySelector('.name').innerText;
      const email = row.querySelector('.email').innerText;
      const phone = row.querySelector('.phone').innerText;
      const subject = row.querySelector('.subject').innerText;

      fetch('/admin/update-teacher/' + id, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email, phone, subject })
      })
        .then(res => res.json())
        .then(data => alert(data.message));
    }

    function deleteTeacher(id) {
      if (confirm('Are you sure?')) {
        fetch('/admin/delete-teacher/' + id, { method: 'DELETE' })
          .then(res => res.json())
          .then(data => {
            alert(data.message);
            fetchTeachers();
          });
      }
    }

    // Initial fetch
    fetchTeachers();
  </script>
</body>

</html>