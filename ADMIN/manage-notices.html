<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Notices</title>
   <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="/CSS/manage-notice.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
    body { display: flex; min-height: 100vh; background: #f0f2f5; }
    .sidebar { width: 220px; background: #2c3e50; color: #fff; padding: 20px; flex-shrink: 0; }
    .sidebar h2 { text-align: center; margin-bottom: 20px; font-size: 20px; }
    .sidebar ul { list-style: none; }
    .sidebar ul li { margin: 15px 0; }
    .sidebar ul li a { color: #fff; text-decoration: none; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
    .sidebar ul li a:hover { color: #74ebd5; }
    .container { flex-grow: 1; padding: 30px; }
    h2, h3 { color: #333; margin-bottom: 20px; }
    form { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px; }
    input[type="text"], select, input[type="file"], button {
      padding: 10px; font-size: 16px; border-radius: 8px; border: 1px solid #ccc; transition: 0.3s;
    }
    input:focus, select:focus, input[type="file"]:focus {
      border-color: #74ebd5; outline: none; box-shadow: 0 0 5px rgba(116, 235, 213, 0.5);
    }
    button {
      background: #74ebd5; border: none; color: #fff; font-weight: bold; cursor: pointer; transition: 0.3s;
    }
    button:hover { background: #4db6ac; }
    table {
      width: 100%; border-collapse: collapse; background: #fff; border-radius: 10px; overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    table th, table td { padding: 12px; text-align: center; border-bottom: 1px solid #ddd; }
    table th { background: #f4f4f4; }
    .view-link { color: #3498db; text-decoration: none; font-weight: bold; margin: 0 5px; }
    .delete-btn {
      background: #e74c3c; border: none; color: #fff; padding: 6px 12px; border-radius: 6px;
      cursor: pointer; transition: 0.3s;
    }
    .delete-btn:hover { background: #c0392b; }
    @media screen and (max-width: 768px) {
      body { flex-direction: column; }
      .sidebar { width: 100%; display: flex; justify-content: space-around; }
      .container { padding: 20px; }
      table th, table td { font-size: 14px; padding: 8px; }
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <h2>Admin Panel</h2>
    <ul>
      <li><a href="admin-home.html"><i class="fa fa-home"></i> Dashboard</a></li>
      <li><a href="manage-teachers.html"><i class="fa fa-users"></i> Manage Teachers</a></li>
      <li><a href="manage-notices.html"><i class="fa fa-bell"></i> Manage Notices</a></li>
      <li><a href="manage-gallery.html"><i class="fa fa-image"></i> Manage Gallery</a></li>
      <li><a href="school-timing.html"><i class="fa fa-graduation-cap"></i> Class Routine</a></li>
      <li><a href="settings.html"><i class="fa fa-cog"></i> Settings</a></li>
      <li><a href="login.html"><i class="fa fa-sign-out"></i> Logout</a></li>
    </ul>
  </div>

  <div class="container">
    <h2>Upload New Notice</h2>
    <form id="noticeForm" enctype="multipart/form-data">
      <input type="text" name="title" placeholder="Notice Title" required />
      <select name="category" required>
        <option value="">Select Category</option>
        <option value="event">Event Notice</option>
        <option value="admission">Admission Notice</option>
        <option value="exam">Exam Notice</option>
        <option value="academic">Academic Notice</option>
        <option value="result">Result</option>
      </select>
      <input type="file" name="pdf_file" accept="application/pdf" required />
      <button type="submit"><i class="fa fa-upload"></i> Upload</button>
    </form>

    <h3>All Notices</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Category</th>
          <th>Title</th>
          <th>File</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="noticeTable"></tbody>
    </table>
  </div>

  <script>
    const noticeForm = document.getElementById("noticeForm");
    const noticeTable = document.getElementById("noticeTable");

    async function loadNotices() {
      try {
        const res = await fetch("/api/notices");
        const data = await res.json();
        noticeTable.innerHTML = "";

        data.forEach((n, i) => {
          let viewURL = n.pdf_file;
          if (viewURL.includes("/raw/upload/")) {
            viewURL = viewURL.replace("/raw/upload/", "/raw/upload/fl_attachment:false/");
          }

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${i + 1}</td>
            <td>${n.category}</td>
            <td>${n.title}</td>
            <td>
              <a class="view-link" href="${viewURL}" target="_blank">View</a> |
              <a class="view-link" href="${n.pdf_file}" download>Download</a>
            </td>
            <td>
              <button class="delete-btn" data-id="${n._id}">
                <i class="fa fa-trash"></i> Delete
              </button>
            </td>
          `;
          noticeTable.appendChild(tr);
        });

        document.querySelectorAll(".delete-btn").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const id = btn.dataset.id;
            if (!confirm("Are you sure you want to delete this notice?")) return;
            try {
              const res = await fetch(`/admin/delete-notice/${id}`, { method: "DELETE" });
              const data = await res.json();
              alert(data.message);
              if (data.success) loadNotices();
            } catch (err) {
              alert("Server error!");
              console.error(err);
            }
          });
        });
      } catch (err) {
        console.error("Error loading notices:", err);
      }
    }

    noticeForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(noticeForm);
      try {
        const res = await fetch("/admin/add-notice", { method: "POST", body: formData });
        const data = await res.json();
        alert(data.message);
        if (data.success) {
          noticeForm.reset();
          loadNotices();
        }
      } catch (err) {
        console.error("Error uploading notice:", err);
        alert("Server error!");
      }
    });

    loadNotices();
  </script>
</body>
</html>
